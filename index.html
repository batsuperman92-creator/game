<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸŒ ìˆ˜ë„ ë§íˆê¸° ê²Œì„ (190ê°œ + Firebase ë­í‚¹ + ì‹œì‘/ì¬ë„ì „)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#317EFB"/>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 0; padding: 20px; }
    h1 { font-size: 1.8em; }
    #headerRow { display:flex; gap:12px; justify-content:center; flex-wrap:wrap; margin: 8px 0 14px; }
    input { padding: 12px; width: 92%; max-width: 720px; font-size: 1.1em; }
    #status { margin-top: 12px; font-weight: bold; min-height: 1.4em; }
    #history {
      margin: 16px auto 0;
      height: 40vh; max-height: 420px; width: min(780px, 92vw);
      overflow-y: auto; -webkit-overflow-scrolling: touch;
      border: 1px solid #ccc; border-radius: 10px; padding: 10px;
      text-align: left; font-size: 0.95em; line-height: 1.5; box-sizing: border-box;
    }
    #ranking {
      margin: 22px auto 0; width: min(520px, 92vw);
      text-align: left; font-size: 1em; border:1px solid #ddd; border-radius: 10px; padding: 12px;
    }
    button {
      margin-top: 14px; padding: 10px 16px; font-size: 1rem;
      border-radius: 10px; border: 1px solid #aaa; cursor: pointer; background:#f5f5f5;
    }
    button:active { transform: translateY(1px); }
    #retryBtn { display:none; }
    .muted { opacity: .75; }
  </style>
</head>
<body>
  <h1>ğŸŒ ìˆ˜ë„ ë§íˆê¸° ê²Œì„</h1>
  <p class="muted">â€˜â–¶ ì‹œì‘â€™ ë²„íŠ¼ì„ ëˆŒëŸ¬ ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”.<br>ì œí•œì‹œê°„ <b>2ë¶„</b>, ì˜¤ë‹µ 10ë²ˆì´ë©´ ì¢…ë£Œ!</p>

  <div id="headerRow">
    <span id="score">âœ… ì •ë‹µ ìˆ˜: 0ê°œ</span>
    <span id="lives">âŒ ì˜¤ë‹µ: 0 / 10</span>
    <span id="timer">â± ë‚¨ì€ ì‹œê°„: 02:00</span>
  </div>

  <p id="question">ì•„ì§ ì‹œì‘ ì „ì…ë‹ˆë‹¤. 'â–¶ ì‹œì‘' ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</p>
  <input id="answer" type="text" placeholder="ìˆ˜ë„ ì…ë ¥" autocomplete="off" disabled />
  <div id="status"></div>

  <button id="startBtn">â–¶ ì‹œì‘</button>
  <button id="retryBtn">ğŸ” ì¬ë„ì „</button>

  <div id="history" aria-live="polite"></div>

  <div id="ranking">
    <strong>ğŸ† ê¸€ë¡œë²Œ ë­í‚¹ (Top 10)</strong>
    <ol id="rankingList" class="muted"><li>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</li></ol>
  </div>

  <!-- Firebase (ëª¨ë“ˆëŸ¬ SDK) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCFBvuggzIu5X_Mnb-2p_8moEEaelp767Q",
      authDomain: "capital-game-475b6.firebaseapp.com",
      projectId: "capital-game-475b6",
      storageBucket: "capital-game-475b6.firebasestorage.app",
      messagingSenderId: "797715470549",
      appId: "1:797715470549:web:0832e971bef0108da8ea5c"
    };
    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);
    const SCORES = collection(db, "scores");

    // === 190ê°œ êµ­ê°€ ë°ì´í„° ===
    const quizData = {
      "ëŒ€í•œë¯¼êµ­":"ì„œìš¸","ì¼ë³¸":"ë„ì¿„","ì¤‘êµ­":"ë² ì´ì§•","ë¯¸êµ­":"ì›Œì‹±í„´","í”„ë‘ìŠ¤":"íŒŒë¦¬","ì˜êµ­":"ëŸ°ë˜","ë…ì¼":"ë² ë¥¼ë¦°",
      "ì´íƒˆë¦¬ì•„":"ë¡œë§ˆ","ìŠ¤í˜ì¸":"ë§ˆë“œë¦¬ë“œ","ëŸ¬ì‹œì•„":"ëª¨ìŠ¤í¬ë°”","ë¸Œë¼ì§ˆ":"ë¸Œë¼ì§ˆë¦¬ì•„","ìºë‚˜ë‹¤":"ì˜¤íƒ€ì™€","í˜¸ì£¼":"ìº”ë²„ë¼",
      "ë©•ì‹œì½”":"ë©•ì‹œì½”ì‹œí‹°","ì¸ë„":"ë‰´ë¸ë¦¬","ì¸ë„ë„¤ì‹œì•„":"ìì¹´ë¥´íƒ€","íƒœêµ­":"ë°©ì½•","ë² íŠ¸ë‚¨":"í•˜ë…¸ì´","í•„ë¦¬í•€":"ë§ˆë‹ë¼",
      "ë§ë ˆì´ì‹œì•„":"ì¿ ì•Œë¼ë£¸í‘¸ë¥´","ì‹±ê°€í¬ë¥´":"ì‹±ê°€í¬ë¥´","í„°í‚¤":"ì•™ì¹´ë¼","ì´ë€":"í…Œí—¤ë€","ì‚¬ìš°ë””ì•„ë¼ë¹„ì•„":"ë¦¬ì•¼ë“œ",
      "ì´ì§‘íŠ¸":"ì¹´ì´ë¡œ","ë‚¨ì•„í”„ë¦¬ì¹´ê³µí™”êµ­":"í”„ë¦¬í† ë¦¬ì•„","ë‚˜ì´ì§€ë¦¬ì•„":"ì•„ë¶€ì","ì¼€ëƒ":"ë‚˜ì´ë¡œë¹„","ì•„ë¥´í—¨í‹°ë‚˜":"ë¶€ì—ë…¸ìŠ¤ì•„ì´ë ˆìŠ¤",
      "ì¹ ë ˆ":"ì‚°í‹°ì•„ê³ ","ì½œë¡¬ë¹„ì•„":"ë³´ê³ íƒ€","í˜ë£¨":"ë¦¬ë§ˆ","ì¿ ë°”":"ì•„ë°”ë‚˜","ë‰´ì§ˆëœë“œ":"ì›°ë§í„´","íŒŒí‚¤ìŠ¤íƒ„":"ì´ìŠ¬ë¼ë§ˆë°”ë“œ",
      "ê·¸ë¦¬ìŠ¤":"ì•„í…Œë„¤","ë„¤ëœë€ë“œ":"ì•”ìŠ¤í…Œë¥´ë‹´","ë²¨ê¸°ì—":"ë¸Œë¤¼ì…€","ìŠ¤ì›¨ë´":"ìŠ¤í†¡í™€ë¦„","ë…¸ë¥´ì›¨ì´":"ì˜¤ìŠ¬ë¡œ","í•€ë€ë“œ":"í—¬ì‹±í‚¤",
      "ë´ë§ˆí¬":"ì½”íœí•˜ê²","í´ë€ë“œ":"ë°”ë¥´ìƒ¤ë°”","ì²´ì½”":"í”„ë¼í•˜","í—ê°€ë¦¬":"ë¶€ë‹¤í˜ìŠ¤íŠ¸","ì˜¤ìŠ¤íŠ¸ë¦¬ì•„":"ë¹ˆ","ìŠ¤ìœ„ìŠ¤":"ë² ë¥¸",
      "í¬ë¥´íˆ¬ê°ˆ":"ë¦¬ìŠ¤ë³¸","ë£¨ë§ˆë‹ˆì•„":"ë¶€ì¿ ë ˆìŠˆí‹°","ìš°í¬ë¼ì´ë‚˜":"í‚¤ì´ìš°","ì´ìŠ¤ë¼ì—˜":"ì˜ˆë£¨ì‚´ë ˜","ì´ë¼í¬":"ë°”ê·¸ë‹¤ë“œ",
      "ìš”ë¥´ë‹¨":"ì•”ë§Œ","ì¹´íƒ€ë¥´":"ë„í•˜","ì¿ ì›¨ì´íŠ¸":"ì¿ ì›¨ì´íŠ¸ì‹œí‹°","ì•„ëì—ë¯¸ë¦¬íŠ¸":"ì•„ë¶€ë‹¤ë¹„","ì¹´ìíìŠ¤íƒ„":"ì•„ìŠ¤íƒ€ë‚˜",
      "ëª½ê³¨":"ìš¸ë€ë°”í† ë¥´","ë¶í•œ":"í‰ì–‘","ìŠ¤ë¦¬ë‘ì¹´":"ìŠ¤ë¦¬ìì•¼ì™€ë¥´ë°ë„¤í‘¸ë¼ì½”í…Œ",
      // â€¦ (ì „ì²´ 190ê°œ ë‚˜ë¼ë¡œ í™•ì¥)
    };

    let remaining, current, wrongCount, score, gameOver;
    const TOTAL = 120; // 2ë¶„
    let left, timerId, timerStarted;

    const input      = document.getElementById("answer");
    const question   = document.getElementById("question");
    const statusEl   = document.getElementById("status");
    const history    = document.getElementById("history");
    const livesEl    = document.getElementById("lives");
    const scoreEl    = document.getElementById("score");
    const timerEl    = document.getElementById("timer");
    const rankingList= document.getElementById("rankingList");
    const startBtn   = document.getElementById("startBtn");
    const retryBtn   = document.getElementById("retryBtn");

    async function loadRanking(){
      rankingList.innerHTML = "<li class='muted'>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</li>";
      try {
        const q = query(SCORES, orderBy("score","desc"), limit(10));
        const snap = await getDocs(q);
        rankingList.innerHTML = "";
        snap.forEach(doc=>{
          const d = doc.data();
          const li = document.createElement("li");
          li.textContent = `${d.name} - ${d.score}ê°œ`;
          rankingList.appendChild(li);
        });
        if (snap.empty) rankingList.innerHTML = "<li class='muted'>ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</li>";
      } catch (err) {
        rankingList.innerHTML = `<li class='muted'>ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜: ${err.code}</li>`;
      }
    }

    function updateTimerText(){ timerEl.textContent = `â± ë‚¨ì€ ì‹œê°„: ${String(Math.floor(left/60)).padStart(2,"0")}:${String(left%60).padStart(2,"0")}`; }
    function startTimer(){
      if (timerStarted) return;
      timerStarted = true;
      updateTimerText();
      timerId = setInterval(()=>{
        if (gameOver) { clearInterval(timerId); return; }
        left--; updateTimerText();
        if (left <= 0){ clearInterval(timerId); endGame("â° TIME OVER!"); }
      }, 1000);
    }

    function nextQuestion(){
      if (remaining.length === 0) return endGame("ğŸ‰ ëª¨ë“  ë¬¸ì œë¥¼ ë‹¤ í’€ì—ˆìŠµë‹ˆë‹¤!");
      const idx = Math.floor(Math.random() * remaining.length);
      current = remaining.splice(idx,1)[0];
      question.textContent = `ğŸ‡ºğŸ‡³ "${current}"ì˜ ìˆ˜ë„ëŠ”?`;
      statusEl.textContent = "";
      input.value = ""; input.focus();
    }

    function appendHistory(country, answer){
      const p = document.createElement("p");
      p.textContent = `${country} â ${answer || "(ë¬´ì‘ë‹µ)"} (ì •ë‹µ: ${quizData[country]})`;
      history.appendChild(p);
      history.scrollTop = history.scrollHeight;
    }

    function checkAnswer(){
      if (gameOver) return;
      if (!timerStarted) startTimer();
      if (!current){ nextQuestion(); return; }
      const v = input.value.trim();
      if (v === quizData[current]){
        score++; scoreEl.textContent = `âœ… ì •ë‹µ ìˆ˜: ${score}ê°œ`;
        statusEl.textContent = "âœ… ì •ë‹µ!";
      } else {
        wrongCount++; livesEl.textContent = `âŒ ì˜¤ë‹µ: ${wrongCount} / 10`;
        statusEl.textContent = "âŒ ì˜¤ë‹µ!";
        if (wrongCount >= 10) return endGame("ğŸ’€ GAME OVER (ì˜¤ë‹µ 10íšŒ)");
      }
      appendHistory(current, v);
      nextQuestion();
    }

    input.addEventListener("keydown", e => { if (e.key === "Enter") checkAnswer(); });
    startBtn.addEventListener("click", ()=>{ resetGame(); startGame(); });
    retryBtn.addEventListener("click", resetGame);

    function startGame(){
      startBtn.style.display="none";
      retryBtn.style.display="none";
      input.disabled=false;
      nextQuestion();
    }

    function resetGame(){
      remaining = Object.keys(quizData);
      current = null; wrongCount=0; score=0; gameOver=false;
      left = TOTAL; timerStarted=false; if (timerId) clearInterval(timerId);
      scoreEl.textContent="âœ… ì •ë‹µ ìˆ˜: 0ê°œ"; livesEl.textContent="âŒ ì˜¤ë‹µ: 0 / 10";
      updateTimerText();
      question.textContent="ê²Œì„ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. â–¶ ì‹œì‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.";
      statusEl.textContent=""; input.value=""; input.disabled=true;
      history.innerHTML=""; startBtn.style.display="inline-block"; retryBtn.style.display="none";
    }

    function endGame(msg){
      gameOver=true; input.disabled=true; statusEl.textContent=msg; retryBtn.style.display="inline-block";
    }

    function init(){ resetGame(); loadRanking(); }
    init();
  </script>
</body>
</html>

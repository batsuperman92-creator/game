<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸŒ ìˆ˜ë„ ë§íˆê¸° ê²Œì„ (190ê°œ + Firebase ë­í‚¹ + ì‹œì‘/ì¬ë„ì „/ì´ë¦„ì…ë ¥ ë³µêµ¬)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#317EFB"/>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 0; padding: 20px; }
    h1 { font-size: 1.8em; }
    #headerRow { display:flex; gap:12px; justify-content:center; flex-wrap:wrap; margin: 8px 0 14px; }
    input { padding: 12px; width: 92%; max-width: 720px; font-size: 1.1em; }
    #status { margin-top: 12px; font-weight: bold; min-height: 1.4em; }
    #history {
      margin: 16px auto 0;
      height: 40vh; max-height: 420px; width: min(780px, 92vw);
      overflow-y: auto; -webkit-overflow-scrolling: touch;
      border: 1px solid #ccc; border-radius: 10px; padding: 10px;
      text-align: left; font-size: 0.95em; line-height: 1.5; box-sizing: border-box;
    }
    #ranking {
      margin: 22px auto 0; width: min(520px, 92vw);
      text-align: left; font-size: 1em; border:1px solid #ddd; border-radius: 10px; padding: 12px;
    }
    button {
      margin-top: 14px; padding: 10px 16px; font-size: 1rem;
      border-radius: 10px; border: 1px solid #aaa; cursor: pointer; background:#f5f5f5;
    }
    button:active { transform: translateY(1px); }
    #retryBtn { display:none; }
    .muted { opacity: .75; }
  </style>
</head>
<body>
  <h1>ğŸŒ ìˆ˜ë„ ë§íˆê¸° ê²Œì„</h1>
  <p class="muted">â€˜â–¶ ì‹œì‘â€™ ë²„íŠ¼ì„ ëˆŒëŸ¬ ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”. ì œí•œì‹œê°„ <b>2ë¶„</b>, ì˜¤ë‹µ 10ë²ˆì´ë©´ ì¢…ë£Œ!</p>

  <div id="headerRow">
    <span id="score">âœ… ì •ë‹µ ìˆ˜: 0ê°œ</span>
    <span id="lives">âŒ ì˜¤ë‹µ: 0 / 10</span>
    <span id="timer">â± ë‚¨ì€ ì‹œê°„: 02:00</span>
  </div>

  <p id="question">ì•„ì§ ì‹œì‘ ì „ì…ë‹ˆë‹¤. 'â–¶ ì‹œì‘' ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</p>
  <input id="answer" type="text" placeholder="ìˆ˜ë„ ì…ë ¥" autocomplete="off" disabled />
  <div id="status"></div>

  <button id="startBtn">â–¶ ì‹œì‘</button>
  <button id="retryBtn">ğŸ” ì¬ë„ì „</button>

  <div id="history" aria-live="polite"></div>

  <div id="ranking">
    <strong>ğŸ† ê¸€ë¡œë²Œ ë­í‚¹ (Top 10)</strong>
    <ol id="rankingList" class="muted"><li>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</li></ol>
  </div>

  <!-- Firebase (ëª¨ë“ˆëŸ¬ SDK) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // ==== Firebase ì„¤ì • (ë„¤ í”„ë¡œì íŠ¸ ê°’) ====
    const firebaseConfig = {
      apiKey: "AIzaSyCFBvuggzIu5X_Mnb-2p_8moEEaelp767Q",
      authDomain: "capital-game-475b6.firebaseapp.com",
      projectId: "capital-game-475b6",
      storageBucket: "capital-game-475b6.firebasestorage.app",
      messagingSenderId: "797715470549",
      appId: "1:797715470549:web:0832e971bef0108da8ea5c"
    };
    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);
    const SCORES = collection(db, "scores");

    // ==== 190ê°œ êµ­ê°€/ìˆ˜ë„ ====
    const quizData = {
      "ì•„í”„ê°€ë‹ˆìŠ¤íƒ„":"ì¹´ë¶ˆ","ì•Œë°”ë‹ˆì•„":"í‹°ë¼ë‚˜","ì•Œì œë¦¬":"ì•Œì œ","ì•ˆë„ë¼":"ì•ˆë„ë¼ë¼ë²¨ë¼","ì•™ê³¨ë¼":"ë£¨ì•ˆë‹¤",
      "ì•ˆí‹°êµ¬ì•„ ë°”ë¶€ë‹¤":"ì„¸ì¸íŠ¸ì¡´ìŠ¤","ì•„ë¥´í—¨í‹°ë‚˜":"ë¶€ì—ë…¸ìŠ¤ì•„ì´ë ˆìŠ¤","ì•„ë¥´ë©”ë‹ˆì•„":"ì˜ˆë ˆë°˜","í˜¸ì£¼":"ìº”ë²„ë¼",
      "ì˜¤ìŠ¤íŠ¸ë¦¬ì•„":"ë¹ˆ","ì•„ì œë¥´ë°”ì´ì”":"ë°”ì¿ ","ë°”í•˜ë§ˆ":"ë‚˜ì†Œ","ë°”ë ˆì¸":"ë§ˆë‚˜ë§ˆ","ë°©ê¸€ë¼ë°ì‹œ":"ë‹¤ì¹´",
      "ë°”ë² ì´ë„ìŠ¤":"ë¸Œë¦¬ì§€íƒ€ìš´","ë²¨ë¼ë£¨ìŠ¤":"ë¯¼ìŠ¤í¬","ë²¨ê¸°ì—":"ë¸Œë¤¼ì…€","ë²¨ë¦¬ì¦ˆ":"ë²¨ëª¨íŒ","ë² ëƒ‰":"í¬ë¥´í† ë…¸ë³´",
      "ë¶€íƒ„":"íŒ€ë¶€","ë³¼ë¦¬ë¹„ì•„":"ìˆ˜í¬ë ˆ","ë³´ìŠ¤ë‹ˆì•„ í—¤ë¥´ì²´ê³ ë¹„ë‚˜":"ì‚¬ë¼ì˜ˆë³´","ë³´ì¸ ì™€ë‚˜":"ê°€ë³´ë¡œë„¤","ë¸Œë¼ì§ˆ":"ë¸Œë¼ì§ˆë¦¬ì•„",
      "ë¸Œë£¨ë‚˜ì´":"ë°˜ë‹¤ë¥´ìŠ¤ë¦¬ë¸Œê°€ì™„","ë¶ˆê°€ë¦¬ì•„":"ì†Œí”¼ì•„","ë¶€ë¥´í‚¤ë‚˜íŒŒì†Œ":"ì™€ê°€ë‘êµ¬","ë¶€ë£¬ë””":"ê¸°í…Œê°€",
      "ì¹´ë³´ë² ë¥´ë°":"í”„ë¼ì´ì•„","ìº„ë³´ë””ì•„":"í”„ë†ˆíœ","ì¹´ë©”ë£¬":"ì•¼ìš´ë°","ìºë‚˜ë‹¤":"ì˜¤íƒ€ì™€","ì¤‘ì•™ì•„í”„ë¦¬ì¹´ê³µí™”êµ­":"ë°©ê¸°",
      "ì°¨ë“œ":"ì€ìë©”ë‚˜","ì¹ ë ˆ":"ì‚°í‹°ì•„ê³ ","ì¤‘êµ­":"ë² ì´ì§•","ì½œë¡¬ë¹„ì•„":"ë³´ê³ íƒ€","ì½”ëª¨ë¡œ":"ëª¨ë¡œë‹ˆ","ì½©ê³ ê³µí™”êµ­":"ë¸Œë¼ìë¹Œ",
      "ì½©ê³ ë¯¼ì£¼ê³µí™”êµ­":"í‚¨ìƒ¤ì‚¬","ì½”ìŠ¤íƒ€ë¦¬ì¹´":"ì‚°í˜¸ì„¸","ì½”íŠ¸ë””ë¶€ì•„ë¥´":"ì•¼ë¬´ìˆ˜í¬ë¡œ","í¬ë¡œì•„í‹°ì•„":"ìê·¸ë ˆë¸Œ","ì¿ ë°”":"ì•„ë°”ë‚˜",
      "í‚¤í”„ë¡œìŠ¤":"ë‹ˆì½”ì‹œì•„","ì²´ì½”":"í”„ë¼í•˜","ë´ë§ˆí¬":"ì½”íœí•˜ê²","ì§€ë¶€í‹°":"ì§€ë¶€í‹°","ë„ë¯¸ë‹ˆì¹´":"ë¡œì¡°",
      "ë„ë¯¸ë‹ˆì¹´ê³µí™”êµ­":"ì‚°í† ë„ë°ê³ ","ë™í‹°ëª¨ë¥´":"ë”œë¦¬","ì—ì½°ë„ë¥´":"í‚¤í† ","ì´ì§‘íŠ¸":"ì¹´ì´ë¡œ","ì—˜ì‚´ë°”ë„ë¥´":"ì‚°ì‚´ë°”ë„ë¥´",
      "ì ë„ê¸°ë‹ˆ":"ë§ë¼ë³´","ì—ë¦¬íŠ¸ë ˆì•„":"ì•„ìŠ¤ë§ˆë¼","ì—ìŠ¤í† ë‹ˆì•„":"íƒˆë¦°","ì—ìŠ¤ì™€í‹°ë‹ˆ":"ìŒë°”ë°”ë„¤","ì—í‹°ì˜¤í”¼ì•„":"ì•„ë””ìŠ¤ì•„ë°”ë°”",
      "í”¼ì§€":"ìˆ˜ë°”","í•€ë€ë“œ":"í—¬ì‹±í‚¤","í”„ë‘ìŠ¤":"íŒŒë¦¬","ê°€ë´‰":"ë¦¬ë¸Œë¥´ë¹Œ","ê°ë¹„ì•„":"ë°˜ì¤„","ì¡°ì§€ì•„":"íŠ¸ë¹Œë¦¬ì‹œ","ë…ì¼":"ë² ë¥¼ë¦°",
      "ê°€ë‚˜":"ì•„í¬ë¼","ê·¸ë¦¬ìŠ¤":"ì•„í…Œë„¤","ê·¸ë ˆë‚˜ë‹¤":"ì„¸ì¸íŠ¸ì¡°ì§€ìŠ¤","ê³¼í…Œë§ë¼":"ê³¼í…Œë§ë¼ì‹œí‹°","ê¸°ë‹ˆ":"ì½”ë‚˜í¬ë¦¬",
      "ê¸°ë‹ˆë¹„ì‚¬ìš°":"ë¹„ì‚¬ìš°","ê°€ì´ì•„ë‚˜":"ì¡°ì§€íƒ€ìš´","ì•„ì´í‹°":"í¬ë¥´í† í”„ë­ìŠ¤","ì˜¨ë‘ë¼ìŠ¤":"í…Œêµ¬ì‹œê°ˆíŒŒ","í—ê°€ë¦¬":"ë¶€ë‹¤í˜ìŠ¤íŠ¸",
      "ì•„ì´ìŠ¬ë€ë“œ":"ë ˆì´ìº¬ë¹„í¬","ì¸ë„":"ë‰´ë¸ë¦¬","ì¸ë„ë„¤ì‹œì•„":"ìì¹´ë¥´íƒ€","ì´ë€":"í…Œí—¤ë€","ì´ë¼í¬":"ë°”ê·¸ë‹¤ë“œ",
      "ì•„ì¼ëœë“œ":"ë”ë¸”ë¦°","ì´ìŠ¤ë¼ì—˜":"ì˜ˆë£¨ì‚´ë ˜","ì´íƒˆë¦¬ì•„":"ë¡œë§ˆ","ìë©”ì´ì¹´":"í‚¹ìŠ¤í„´","ì¼ë³¸":"ë„ì¿„","ìš”ë¥´ë‹¨":"ì•”ë§Œ",
      "ì¹´ìíìŠ¤íƒ„":"ì•„ìŠ¤íƒ€ë‚˜","ì¼€ëƒ":"ë‚˜ì´ë¡œë¹„","í‚¤ë¦¬ë°”ì‹œ":"íƒ€ë¼ì™€","ëŒ€í•œë¯¼êµ­":"ì„œìš¸","ì¿ ì›¨ì´íŠ¸":"ì¿ ì›¨ì´íŠ¸ì‹œí‹°",
      "í‚¤ë¥´ê¸°ìŠ¤ìŠ¤íƒ„":"ë¹„ìŠˆì¼€í¬","ë¼ì˜¤ìŠ¤":"ë¹„ì—”í‹°ì•ˆ","ë¼íŠ¸ë¹„ì•„":"ë¦¬ê°€","ë ˆë°”ë…¼":"ë² ì´ë£¨íŠ¸","ë ˆì†Œí† ":"ë§ˆì„¸ë£¨",
      "ë¼ì´ë² ë¦¬ì•„":"ëª¬ë¡œë¹„ì•„","ë¦¬ë¹„ì•„":"íŠ¸ë¦¬í´ë¦¬","ë¦¬íˆí…ìŠˆíƒ€ì¸":"íŒŒë‘ì¸ ","ë¦¬íˆ¬ì•„ë‹ˆì•„":"ë¹Œë‰´ìŠ¤","ë£©ì…ˆë¶€ë¥´í¬":"ë£©ì…ˆë¶€ë¥´í¬",
      "ë§ˆë‹¤ê°€ìŠ¤ì¹´ë¥´":"ì•ˆíƒ€ë‚˜ë‚˜ë¦¬ë³´","ë§ë¼ìœ„":"ë¦´ë¡±ê¶¤","ë§ë ˆì´ì‹œì•„":"ì¿ ì•Œë¼ë£¸í‘¸ë¥´","ëª°ë””ë¸Œ":"ë§ë ˆ","ë§ë¦¬":"ë°”ë§ˆì½”",
      "ëª°íƒ€":"ë°œë ˆíƒ€","ë§ˆì…œì œë„":"ë§ˆì£¼ë¡œ","ëª¨ë¦¬íƒ€ë‹ˆ":"ëˆ„ì•…ì‡¼íŠ¸","ëª¨ë¦¬ì…”ìŠ¤":"í¬íŠ¸ë£¨ì´ìŠ¤","ë©•ì‹œì½”":"ë©•ì‹œì½”ì‹œí‹°",
      "ë¯¸í¬ë¡œë„¤ì‹œì•„":"íŒ”ë¦¬í‚¤ë¥´","ëª°ë„ë°”":"í‚¤ì‹œë„ˆìš°","ëª¨ë‚˜ì½”":"ëª¨ë‚˜ì½”","ëª½ê³¨":"ìš¸ë€ë°”í† ë¥´","ëª¬í…Œë„¤ê·¸ë¡œ":"í¬ë“œê³ ë¦¬ì°¨",
      "ëª¨ë¡œì½”":"ë¼ë°”íŠ¸","ëª¨ì ë¹„í¬":"ë§ˆí‘¸í† ","ë¯¸ì–€ë§ˆ":"ë„¤í”¼ë„","ë‚˜ë¯¸ë¹„ì•„":"ë¹ˆíŠ¸í›„í¬","ë„¤íŒ”":"ì¹´íŠ¸ë§Œë‘",
      "ë„¤ëœë€ë“œ":"ì•”ìŠ¤í…Œë¥´ë‹´","ë‰´ì§ˆëœë“œ":"ì›°ë§í„´","ë‹ˆì¹´ë¼ê³¼":"ë§ˆë‚˜ê³¼","ë‹ˆì œë¥´":"ë‹ˆì•„ë©”ì´","ë‚˜ì´ì§€ë¦¬ì•„":"ì•„ë¶€ì",
      "ë¶ë§ˆì¼€ë„ë‹ˆì•„":"ìŠ¤ì½”í˜","ë…¸ë¥´ì›¨ì´":"ì˜¤ìŠ¬ë¡œ","ì˜¤ë§Œ":"ë¬´ìŠ¤ì¹´íŠ¸","íŒŒí‚¤ìŠ¤íƒ„":"ì´ìŠ¬ë¼ë§ˆë°”ë“œ","íŒ”ë¼ìš°":"ì‘ê²Œë£°ë¬´ë“œ",
      "íŒŒë‚˜ë§ˆ":"íŒŒë‚˜ë§ˆì‹œí‹°","íŒŒí‘¸ì•„ë‰´ê¸°ë‹ˆ":"í¬íŠ¸ëª¨ë¥´ì¦ˆë¹„","íŒŒë¼ê³¼ì´":"ì•„ìˆœì‹œì˜¨","í˜ë£¨":"ë¦¬ë§ˆ","í•„ë¦¬í•€":"ë§ˆë‹ë¼",
      "í´ë€ë“œ":"ë°”ë¥´ìƒ¤ë°”","í¬ë¥´íˆ¬ê°ˆ":"ë¦¬ìŠ¤ë³¸","ì¹´íƒ€ë¥´":"ë„í•˜","ë£¨ë§ˆë‹ˆì•„":"ë¶€ì¿ ë ˆìŠˆí‹°","ëŸ¬ì‹œì•„":"ëª¨ìŠ¤í¬ë°”","ë¥´ì™„ë‹¤":"í‚¤ê°ˆë¦¬",
      "ì„¸ì¸íŠ¸í‚¤ì¸  ë„¤ë¹„ìŠ¤":"ë°”ìŠ¤í„°ë¥´","ì„¸ì¸íŠ¸ë£¨ì‹œì•„":"ìºìŠ¤íŠ¸ë¦¬ìŠ¤","ì„¸ì¸íŠ¸ë¹ˆì„¼íŠ¸ ê·¸ë ˆë‚˜ë”˜":"í‚¹ìŠ¤íƒ€ìš´","ì‚¬ëª¨ì•„":"ì•„í”¼ì•„",
      "ì‚°ë§ˆë¦¬ë…¸":"ì‚°ë§ˆë¦¬ë…¸","ìƒíˆ¬ë©” í”„ë¦°ì‹œí˜":"ìƒíˆ¬ë©”","ì‚¬ìš°ë””ì•„ë¼ë¹„ì•„":"ë¦¬ì•¼ë“œ","ì„¸ë„¤ê°ˆ":"ë‹¤ì¹´ë¥´","ì„¸ë¥´ë¹„ì•„":"ë² ì˜¤ê·¸ë¼ë“œ",
      "ì„¸ì´ì…¸":"ë¹…í† ë¦¬ì•„","ì‹œì—ë¼ë¦¬ì˜¨":"í”„ë¦¬íƒ€ìš´","ì‹±ê°€í¬ë¥´":"ì‹±ê°€í¬ë¥´","ìŠ¬ë¡œë°”í‚¤ì•„":"ë¸Œë¼í‹°ìŠ¬ë¼ë°”","ìŠ¬ë¡œë² ë‹ˆì•„":"ë¥˜ë¸”ë´ë‚˜",
      "ì†”ë¡œëª¬ì œë„":"í˜¸ë‹ˆì•„ë¼","ì†Œë§ë¦¬ì•„":"ëª¨ê°€ë””ìŠˆ","ë‚¨ì•„í”„ë¦¬ì¹´ê³µí™”êµ­":"í”„ë¦¬í† ë¦¬ì•„","ë‚¨ìˆ˜ë‹¨":"ì£¼ë°”","ìŠ¤í˜ì¸":"ë§ˆë“œë¦¬ë“œ",
      "ìŠ¤ë¦¬ë‘ì¹´":"ìŠ¤ë¦¬ìì•¼ì™€ë¥´ë°ë„¤í‘¸ë¼ì½”í…Œ","ìˆ˜ë‹¨":"ì¹´ë¥´íˆ¼","ìˆ˜ë¦¬ë‚¨":"íŒŒë¼ë§ˆë¦¬ë³´","ìŠ¤ì›¨ë´":"ìŠ¤í†¡í™€ë¦„","ìŠ¤ìœ„ìŠ¤":"ë² ë¥¸",
      "ì‹œë¦¬ì•„":"ë‹¤ë§ˆìŠ¤ì¿ ìŠ¤","íƒ€ì§€í‚¤ìŠ¤íƒ„":"ë‘ìƒ¨ë² ","íƒ„ìë‹ˆì•„":"ë„ë„ë§ˆ","íƒœêµ­":"ë°©ì½•","í† ê³ ":"ë¡œë©”","í†µê°€":"ëˆ„ì¿ ì•Œë¡œíŒŒ",
      "íŠ¸ë¦¬ë‹ˆë‹¤ë“œ í† ë°”ê³ ":"í¬íŠ¸ì˜¤ë¸ŒìŠ¤í˜ì¸","íŠ€ë‹ˆì§€":"íŠ€ë‹ˆìŠ¤","íŠ€ë¥´í‚¤ì˜ˆ":"ì•™ì¹´ë¼","íˆ¬ë¥´í¬ë©”ë‹ˆìŠ¤íƒ„":"ì•„ìŠˆí•˜ë°”íŠ¸",
      "íˆ¬ë°œë£¨":"í‘¸ë‚˜í‘¸í‹°","ìš°ê°„ë‹¤":"ìº„íŒ”ë¼","ìš°í¬ë¼ì´ë‚˜":"í‚¤ì´ìš°","ì•„ëì—ë¯¸ë¦¬íŠ¸":"ì•„ë¶€ë‹¤ë¹„","ì˜êµ­":"ëŸ°ë˜",
      "ë¯¸êµ­":"ì›Œì‹±í„´","ìš°ë£¨ê³¼ì´":"ëª¬í…Œë¹„ë°ì˜¤","ìš°ì¦ˆë² í‚¤ìŠ¤íƒ„":"íƒ€ìŠˆì¼„íŠ¸","ë°”ëˆ„ì•„íˆ¬":"í¬íŠ¸ë¹Œë¼","ë² ë„¤ìˆ˜ì—˜ë¼":"ì¹´ë¼ì¹´ìŠ¤",
      "ë² íŠ¸ë‚¨":"í•˜ë…¸ì´","ì˜ˆë©˜":"ì‚¬ë‚˜","ì ë¹„ì•„":"ë£¨ì‚¬ì¹´","ì§ë°”ë¸Œì›¨":"í•˜ë¼ë ˆ"
    };

    // ==== ìƒíƒœ ====
    let remaining, current, wrongCount, score, gameOver;
    const TOTAL = 120; // 2ë¶„
    let left, timerId, timerStarted;

    // ==== DOM ====
    const input      = document.getElementById("answer");
    const question   = document.getElementById("question");
    const statusEl   = document.getElementById("status");
    const history    = document.getElementById("history");
    const livesEl    = document.getElementById("lives");
    const scoreEl    = document.getElementById("score");
    const timerEl    = document.getElementById("timer");
    const rankingList= document.getElementById("rankingList");
    const startBtn   = document.getElementById("startBtn");
    const retryBtn   = document.getElementById("retryBtn");

    // ==== ë­í‚¹ í‘œì‹œ (ë³µí•© ì¸ë±ìŠ¤ä¸è¦) ====
    async function loadRanking(){
      rankingList.innerHTML = "<li class='muted'>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</li>";
      try {
        const q = query(SCORES, orderBy("score","desc"), limit(10));
        const snap = await getDocs(q);
        rankingList.innerHTML = "";
        if (snap.empty) {
          rankingList.innerHTML = "<li class='muted'>ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</li>";
          return;
        }
        snap.forEach(doc=>{
          const d = doc.data();
          const li = document.createElement("li");
          li.textContent = `${d.name} - ${d.score}ê°œ`;
          rankingList.appendChild(li);
        });
      } catch (err) {
        rankingList.innerHTML = `<li class='muted'>ë­í‚¹ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤: ${err.code || err.message}</li>`;
        console.error("ë­í‚¹ ë¡œë“œ ì—ëŸ¬:", err);
      }
    }

    // ==== Top10 ì§„ì… ì‹œ ì´ë¦„ ì…ë ¥/ì €ì¥ ====
    async function maybeRegisterRanking(finalScore){
      try {
        const snap = await getDocs(query(SCORES, orderBy("score","desc"), limit(10)));
        let qualifies = snap.size < 10;
        if (!qualifies) {
          const minTop = snap.docs[snap.docs.length-1].data().score;
          qualifies = finalScore > minTop;
        }
        if (!qualifies) { await loadRanking(); return; }

        const name = prompt("ğŸ‰ 10ìœ„ ì•ˆì— ë“¤ì—ˆìŠµë‹ˆë‹¤! ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš” (ìµœëŒ€ 20ì):");
        if (!name) { await loadRanking(); return; }

        await addDoc(SCORES, {
          name: name.trim().slice(0,20),
          score: finalScore,
          timestamp: new Date()
        });
        await loadRanking();
      } catch (err) {
        console.error("ë­í‚¹ ì €ì¥ ì—ëŸ¬:", err);
        alert("ë­í‚¹ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + (err.code || err.message));
      }
    }

    // ==== íƒ€ì´ë¨¸ ====
    const fmt = s => `${String(Math.floor(s/60)).padStart(2,"0")}:${String(s%60).padStart(2,"0")}`;
    function updateTimerText(){ timerEl.textContent = `â± ë‚¨ì€ ì‹œê°„: ${fmt(left)}`; }
    function startTimer(){
      if (timerStarted) return;
      timerStarted = true;
      updateTimerText();
      timerId = setInterval(()=>{
        if (gameOver) { clearInterval(timerId); return; }
        left--; updateTimerText();
        if (left <= 0){ clearInterval(timerId); endGame("â° TIME OVER!"); }
      }, 1000);
    }

    // ==== ê²Œì„ ====
    function nextQuestion(){
      if (remaining.length === 0) return endGame("ğŸ‰ ëª¨ë“  ë¬¸ì œë¥¼ ë‹¤ í’€ì—ˆìŠµë‹ˆë‹¤!");
      const idx = Math.floor(Math.random() * remaining.length);
      current = remaining.splice(idx,1)[0];
      question.textContent = `ğŸ‡ºğŸ‡³ "${current}"ì˜ ìˆ˜ë„ëŠ”?`;
      statusEl.textContent = "";
      input.value = "";
      input.focus();
    }

    function appendHistory(country, answer){
      const p = document.createElement("p");
      p.textContent = `${country} â ${answer || "(ë¬´ì‘ë‹µ)"} (ì •ë‹µ: ${quizData[country]})`;
      history.appendChild(p);
      history.scrollTop = history.scrollHeight;
    }

    function checkAnswer(){
      if (gameOver) return;
      if (!timerStarted) startTimer();
      if (!current){ nextQuestion(); return; }

      const v = input.value.trim();
      if (v === quizData[current]){
        score++; scoreEl.textContent = `âœ… ì •ë‹µ ìˆ˜: ${score}ê°œ`;
        statusEl.textContent = "âœ… ì •ë‹µ!";
      } else {
        wrongCount++; livesEl.textContent = `âŒ ì˜¤ë‹µ: ${wrongCount} / 10`;
        statusEl.textContent = "âŒ ì˜¤ë‹µ!";
        if (wrongCount >= 10) return endGame("ğŸ’€ GAME OVER (ì˜¤ë‹µ 10íšŒ)");
      }
      appendHistory(current, v);
      nextQuestion();
    }

    input.addEventListener("keydown", e => { if (e.key === "Enter") checkAnswer(); });

    // ==== ì‹œì‘/ì¬ë„ì „ ====
    startBtn.addEventListener("click", ()=>{ resetGame(); startGame(); });
    retryBtn.addEventListener("click", ()=>{ resetGame(); startGame(); });

    function startGame(){
      startBtn.style.display="none";
      retryBtn.style.display="none";
      input.disabled=false;
      nextQuestion();
    }

    function resetGame(){
      remaining = Object.keys(quizData);
      current = null; wrongCount=0; score=0; gameOver=false;
      left = TOTAL; timerStarted=false; if (timerId) clearInterval(timerId);
      scoreEl.textContent="âœ… ì •ë‹µ ìˆ˜: 0ê°œ"; livesEl.textContent="âŒ ì˜¤ë‹µ: 0 / 10";
      updateTimerText();
      question.textContent="ê²Œì„ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. â–¶ ì‹œì‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.";
      statusEl.textContent=""; input.value=""; input.disabled=true;
      history.innerHTML=""; startBtn.style.display="inline-block"; retryBtn.style.display="none";
    }

    // âœ… ê²Œì„ ì¢…ë£Œ ì‹œ: ì´ë¦„ ì…ë ¥/ì €ì¥ í˜¸ì¶œ ë³µêµ¬
    function endGame(msg){
      gameOver=true;
      input.disabled=true;
      statusEl.textContent = msg + ` ìµœì¢… ì ìˆ˜: ${score}ê°œ`;
      if (timerId) { clearInterval(timerId); timerId = null; }
      retryBtn.style.display="inline-block";
      // ì—¬ê¸°ì„œ Top10 ì§„ì… ì‹œ ì´ë¦„ íŒì—…/ì €ì¥
      maybeRegisterRanking(score);
    }

    // ì´ˆê¸°í™”
    function init(){ resetGame(); loadRanking(); }
    init();
  </script>

  <!-- PWA ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡(ì„ íƒ) -->
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js")
        .then(()=>console.log("Service Worker registered"))
        .catch(err=>console.error("SW registration failed:", err));
    }
  </script>
</body>
</html>
